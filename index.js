parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({31:[function(require,module,exports) {
"use strict";var e=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var s={};if(null!=e)for(var a in e)Object.hasOwnProperty.call(e,a)&&(s[a]=e[a]);return s.default=e,s};Object.defineProperty(exports,"__esModule",{value:!0});const s=e(require("apollo-errors")),a=e(require("boom"));exports.ErrorMessages=[{name:"invalid-address",data:{en:{message:"Invalid address provided"},bg:{message:"Invalid address provided"}}},{name:"not-enought-funds",data:{en:{message:"Not enought funds in your wallet"},bg:{message:"Not enought funds in your wallet"}}},{name:"transaction-reverted",data:{en:{message:"Transaction reverted"},bg:{message:"Transaction reverted"}}},{name:"unknown-error",data:{en:{message:"Unknown error contact customer service with given eid"},bg:{message:"Unknown error contact customer service with given eid"}}},{name:"missing-wallet-id",data:{en:{message:"Missing wallet id"},bg:{message:"Missing wallet id"}}},{name:"invalid-address-from",data:{en:{message:"Invalid address from"},bg:{message:"Invalid address from"}}},{name:"invalid-address-to",data:{en:{message:"Invalid address to"},bg:{message:"Невалиден адрес до"}}},{name:"invalid-user-name",data:{en:{message:"Invalid email or password"},bg:{message:"Невалиден имейл или парола"}}},{name:"wrong-user-name-or-password",data:{en:{message:"The username or password are incorrect."},bg:{message:"The username or password are incorrect."}}},{name:"unauthorized",data:{en:{message:"You are unable to fetch data"},bg:{message:"Нямате право да използвате този ресурс"}}},{name:"account-not-found",data:{en:{message:"Ethereum account not found"},bg:{message:"Не е намерен Ethereum адрес"}}},{name:"invalid-account-password",data:{en:{message:"Ethereum wallet password is invalid"},bg:{message:"Въведената парола за декриптиране на портфейла е невалидна"}}}];class r{constructor(){this.errorsList=exports.ErrorMessages}map(e){return this.errorsList.filter(s=>s.name===e)[0].name}}function n(e,s,a){return(a=a||{}).eid=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}(),s=`(${a.eid}): ${s}`,new(exports.clientErrors.createError(e,{message:s,data:a}))}function t(e){throw e.message.includes("invalid address")||e.message.includes("indrect IBAN address which can't be converted")?new n("invalid-address",e.message.substring(0,e.message.indexOf("at")),{rawMessage:e.message.substring(0,e.message.indexOf("at"))}):e.message.includes("have enough funds to send tx")?new n("not-enought-funds",e.message.substring(0,e.message.indexOf("at")),{rawMessage:e.message.substring(0,e.message.indexOf("at"))}):e.message.includes("VM Exception while processing transaction: revert")?new n("transaction-reverted",e.message):e.message.includes("could not unlock signer account")?new n("account-locked",e.message):new n("unknown-error",e.message.substring(0,e.message.indexOf("at")),e)}exports.ServerErrorsList=r,exports.attachErrorHandlers=s.formatError,exports.clientErrors=s,exports.Boom=a,exports.createError=n,exports.errorUnauthorized=function(){throw new n("unauthorized","You are unable to fetch data")},exports.transactionError=t;
},{}],4:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("@rxdi/core");exports.GRAPHQL_PLUGIN_CONFIG=new e.InjectionToken("graphql-configuration-injection-token");
},{}],25:[function(require,module,exports) {
"use strict";var e,t=this&&this.__decorate||function(e,t,o,n){var c,r=arguments.length,i=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(c=e[s])&&(i=(r<3?c(i):r>3?c(t,o,i):c(t,o))||i);return r>3&&i&&Object.defineProperty(t,o,i),i},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,n){t(o,n,e)}},c=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(c,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){e.done?c(e.value):new o(function(t){t(e.value)}).then(i,s)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const r=require("./error.service"),i=require("@rxdi/core"),s=require("../config.tokens");function a(){throw new r.createError("unauthorized","You are unable to fetch data")}let f=class{constructor(e){this.config=e}AttachHooks(e){e.forEach(e=>{if(!e)return;const t=e.getFields();Object.keys(t).forEach(e=>{t[e].scope=t[e].scope||[process.env.APP_DEFAULT_SCOPE||"ADMIN"],t[e].public||this.AddHooks(t[e])})})}canAccess(e,t){return!(!t||!e.filter(e=>e===t.type).length)||a()}AuthenticationHooks(e,t,o,n,c){this.canAccess(e.scope,n)}ResolverHooks(e,t,o,n,c){this.AuthenticationHooks(e,t,o,n,c)}AddHooks(e){if(this.config.authentication){const t=e.resolve;e.resolve=((o,n,r,i)=>c(this,void 0,void 0,function*(){return this.ResolverHooks(e,o,n,r,i),yield t(o,n,r,i)}))}}};f=t([i.Service(),n(0,i.Inject(s.GRAPHQL_PLUGIN_CONFIG)),o("design:paramtypes",["function"==typeof(e=void 0!==s.GRAPHQL_PLUGIN_CONFIG&&s.GRAPHQL_PLUGIN_CONFIG)&&e||Object])],f),exports.HookService=f;
},{"./error.service":31,"../config.tokens":4}],26:[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,t,r,c){var o,n=arguments.length,i=n<3?t:null===c?c=Object.getOwnPropertyDescriptor(t,r):c;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,c);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(n<3?o(i):n>3?o(t,r,i):o(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("graphql"),r=require("@rxdi/core");let c=class{generateSchema(e,r,c){const o={};return e&&(o.query=e),r&&(o.mutation=r),c&&(o.subscription=c),new t.GraphQLSchema(o)}};c=e([r.Service()],c),exports.SchemaService=c;
},{}],27:[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,t,r,c){var o,a=arguments.length,n=a<3?t:null===c?c=Object.getOwnPropertyDescriptor(t,r):c;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,c);else for(var f=e.length-1;f>=0;f--)(o=e[f])&&(n=(a<3?o(n):a>3?o(t,r,n):o(t,r))||n);return a>3&&n&&Object.defineProperty(t,r,n),n},t=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});const r=require("@rxdi/core");let c=class extends r.CacheService{constructor(){super(r.Container.get(r.BootstrapLogger))}};c=e([r.Service(),t("design:paramtypes",[])],c),exports.EffectService=c;
},{}],6:[function(require,module,exports) {
"use strict";var e,t,r,c,i,o=this&&this.__decorate||function(e,t,r,c){var i,o=arguments.length,s=o<3?t:null===c?c=Object.getOwnPropertyDescriptor(t,r):c;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,c);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(r,c){t(r,c,e)}},a=this&&this.__awaiter||function(e,t,r,c){return new(r||(r=Promise))(function(i,o){function s(e){try{a(c.next(e))}catch(e){o(e)}}function n(e){try{a(c.throw(e))}catch(e){o(e)}}function a(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,n)}a((c=c.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const f=require("@rxdi/core"),u=require("graphql"),p=require("../services/hooks.service"),h=require("../services/schema.service"),l=require("fs-extra"),y=require("./effect.service"),d=require("../config.tokens");class v{}exports.FieldsModule=v;class m{}exports.MetaDescriptor=m;let S=class{constructor(e,t,r,c,i){this.moduleService=e,this.hookService=t,this.schemaService=r,this.effectService=c,this.config=i}generateSchema(){const e=[],t={query:{},mutation:{},subscription:{}},r=this.effectService;this.getMetaDescriptors().forEach(({descriptor:c,self:i})=>{const o=c();t[o.method_type][o.method_name]=o;const s=o.effect?o.effect:o.method_name;e.push(s);const n=o.resolve.bind(i);if(o.subscribe){const e=o.subscribe;o.subscribe=function(...t){return e.bind(i)(i,...t)}}o.resolve=function(...e){return a(this,void 0,void 0,function*(){const t=r.map.has(o.method_name),c=r.map.has(o.effect),a=yield n.apply(i,e);if(t||c){let t=[a,...e];t=t.filter(e=>e&&"undefined"!==e),r.getLayer(s).putItem({key:s,data:t})}return a})}});const c=this.generateType(t.query,"Query","Query type for all get requests which will not change persistent data"),i=this.generateType(t.mutation,"Mutation","Mutation type for all requests which will change persistent data"),o=this.generateType(t.subscription,"Subscription","Subscription type for all rabbitmq subscriptions via pub sub");this.hookService.AttachHooks([c,i,o]);const s=this.schemaService.generateSchema(c,i,o);try{this.writeEffectTypes(e)}catch(e){console.error(e,"Effects are not saved to directory")}return s}writeEffectTypes(e){if(!this.config.writeEffects)return;const t=`\n/* tslint:disable */\nfunction strEnum<T extends string>(o: Array<T>): {[K in T]: K} {\n    return o.reduce((res, key) => {\n        res[key] = key;\n        return res;\n    }, Object.create(null));\n}\nexport const EffectTypes = strEnum(${JSON.stringify(e).replace(/'/g,"'").replace(/,/g,",\n")});\nexport type EffectTypes = keyof typeof EffectTypes;\n`,r=process.env.INTROSPECTION_FOLDER||"./src/app/core/api-introspection/";l.ensureDirSync(r),l.writeFileSync(r+"EffectTypes.ts",t,"utf8")}generateType(e,t,r){if(Object.keys(e).length)return new u.GraphQLObjectType({name:t,description:r,fields:e})}getMetaDescriptors(){const e=[];return Array.from(this.moduleService.watcherService._constructors.keys()).filter(e=>"controller"===this.moduleService.watcherService.getConstructor(e).type.metadata.type).map(e=>this.moduleService.watcherService.getConstructor(e)).forEach(t=>Array.from(t.type._descriptors.keys()).map(e=>t.type._descriptors.get(e)).map(e=>e.value).forEach(r=>e.push({descriptor:r,self:t.value}))),e}};S=o([f.Service(),n(4,f.Inject(d.GRAPHQL_PLUGIN_CONFIG)),s("design:paramtypes",["function"==typeof(e=void 0!==f.ModuleService&&f.ModuleService)&&e||Object,"function"==typeof(t=void 0!==p.HookService&&p.HookService)&&t||Object,"function"==typeof(r=void 0!==h.SchemaService&&h.SchemaService)&&r||Object,"function"==typeof(c=void 0!==y.EffectService&&y.EffectService)&&c||Object,"function"==typeof(i=void 0!==d.GRAPHQL_PLUGIN_CONFIG&&d.GRAPHQL_PLUGIN_CONFIG)&&i||Object])],S),exports.BootstrapService=S;
},{"../services/hooks.service":25,"../services/schema.service":26,"./effect.service":27,"../config.tokens":4}],5:[function(require,module,exports) {
"use strict";var e,t,o,r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}},s=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))(function(i,n){function s(e){try{c(r.next(e))}catch(e){n(e)}}function a(e){try{c(r.throw(e))}catch(e){n(e)}}function c(e){e.done?i(e.value):new o(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t};Object.defineProperty(exports,"__esModule",{value:!0});const c=require("@rxdi/core"),h=a(require("boom")),u=require("hapi"),p=require("apollo-server-core"),f=require("@rxdi/hapi"),l=require("../config.tokens"),d=require("../services/bootstrap.service");let g=class{constructor(e,t,o){this.server=e,this.config=t,this.bootstrapService=o}OnInit(){let e;try{e=c.Container.get("gapi-custom-schema-definition")}catch(e){}this.config.graphqlOptions.schema=e||this.config.graphqlOptions.schema||this.bootstrapService.generateSchema(),this.register()}register(){if(!this.config||!this.config.graphqlOptions)throw new Error("Apollo Server requires options.");console.log("APOLLO PLUGIN REGISTER"),this.server.route({method:["GET","POST"],path:this.config.path||"/graphql",vhost:this.config.vhost||void 0,config:this.config.route||{},handler:this.handler.bind(this)})}handler(e,t){return s(this,void 0,void 0,function*(){try{if(e.headers.authorization&&"undefined"!==e.headers.authorization&&this.config.authentication)try{const t=c.Container.get(this.config.authentication);this.config.graphqlOptions.context=yield t.validateToken(e.headers.authorization)}catch(e){return h.unauthorized()}else this.config.graphqlOptions.context=null;const o=yield p.runHttpQuery([e],{method:e.method.toUpperCase(),options:this.config.graphqlOptions,query:"post"===e.method?e.payload:e.query}),r=t.response(o);return r.type("application/json"),r}catch(e){if("HttpQueryError"!==e.name)throw h.boomify(e);if(!0===e.isGraphQLError){const o=t.response(e.message);return o.code(e.statusCode),o.type("application/json"),o}const o=new h(e.message,{statusCode:e.statusCode});throw e.headers&&Object.keys(e.headers).forEach(t=>{o.output.headers[t]=e.headers[t]}),o.output.payload.message=e.message,o}})}};g=r([c.Service(),n(0,c.Inject(f.HAPI_SERVER)),n(1,c.Inject(l.GRAPHQL_PLUGIN_CONFIG)),i("design:paramtypes",["function"==typeof(e=void 0!==u.Server&&u.Server)&&e||Object,"function"==typeof(t=void 0!==l.GRAPHQL_PLUGIN_CONFIG&&l.GRAPHQL_PLUGIN_CONFIG)&&t||Object,"function"==typeof(o=void 0!==d.BootstrapService&&d.BootstrapService)&&o||Object])],g),exports.ApolloService=g;
},{"../config.tokens":4,"../services/bootstrap.service":6}],7:[function(require,module,exports) {
"use strict";var e,t,r=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,c=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(o<3?n(c):o>3?n(t,r,c):n(t,r))||c);return o>3&&c&&Object.defineProperty(t,r,c),c},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(r,i){t(r,i,e)}},o=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function c(e){try{a(i.next(e))}catch(e){o(e)}}function s(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(c,s)}a((i=i.apply(e,t||[])).next())})},c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(exports,"__esModule",{value:!0});const s=require("@rxdi/core"),a=require("@rxdi/hapi"),h=require("../config.tokens"),f=require("hapi"),u=c(require("apollo-server-module-graphiql"));let l=class{constructor(e,t){this.server=e,this.config=t}OnInit(){if(!this.config||!this.config.graphiqlOptions)throw new Error("Apollo Server GraphiQL requires options.");this.register()}register(){return o(this,void 0,void 0,function*(){this.config.graphiql&&this.server.route({method:"GET",path:this.config.graphiQlPath||"/graphiql",config:this.config.route||{},handler:this.handler.bind(this)})})}handler(e,t){return o(this,void 0,void 0,function*(){const r=yield u.resolveGraphiQLString(e.query,this.config.graphiqlOptions,e),i=t.response(r);return i.type("text/html"),i})}};l=r([s.Service(),n(0,s.Inject(a.HAPI_SERVER)),n(1,s.Inject(h.GRAPHQL_PLUGIN_CONFIG)),i("design:paramtypes",["function"==typeof(e=void 0!==f.Server&&f.Server)&&e||Object,"function"==typeof(t=void 0!==h.GRAPHQL_PLUGIN_CONFIG&&h.GRAPHQL_PLUGIN_CONFIG)&&t||Object])],l),exports.GraphiQLService=l;
},{"../config.tokens":4}],8:[function(require,module,exports) {
"use strict";var e,t,r,o,i=this&&this.__decorate||function(e,t,r,o){var i,c=arguments.length,n=c<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(n=(c<3?i(n):c>3?i(t,r,n):i(t,r))||n);return c>3&&n&&Object.defineProperty(t,r,n),n},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(exports,"__esModule",{value:!0});const s=require("@rxdi/core"),f=require("@rxdi/hapi"),a=require("hapi"),p=require("../config.tokens");let u=class{constructor(e,t,r,o){this.server=e,this.config=t,this.logger=r,this.openService=o}startBrowser(){this.openService.openPage(`http://${this.server.info.address}:${this.server.info.port}/devtools`),this.logger.log("Browser started!")}};u=i([s.Service(),n(0,s.Inject(f.HAPI_SERVER)),n(1,s.Inject(p.GRAPHQL_PLUGIN_CONFIG)),c("design:paramtypes",["function"==typeof(e=void 0!==a.Server&&a.Server)&&e||Object,"function"==typeof(t=void 0!==p.GRAPHQL_PLUGIN_CONFIG&&p.GRAPHQL_PLUGIN_CONFIG)&&t||Object,"function"==typeof(r=void 0!==s.BootstrapLogger&&s.BootstrapLogger)&&r||Object,"function"==typeof(o=void 0!==f.OpenService&&f.OpenService)&&o||Object])],u),exports.StartService=u;
},{"../config.tokens":4}],32:[function(require,module,exports) {
"use strict";var e,t,r,i,n,s,o=this&&this.__decorate||function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(r,i){t(r,i,e)}},h=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,s){function o(e){try{a(i.next(e))}catch(e){s(e)}}function c(e){try{a(i.throw(e))}catch(e){s(e)}}function a(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(o,c)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const u=require("@rxdi/core"),d=require("../config.tokens"),f=require("http"),l=require("hapi"),p=require("@rxdi/hapi"),v=require("rxjs"),S=require("rxjs/operators"),b=require("./start.service");let y=class{constructor(e,t,r,i,n,s){this.config=e,this.server=t,this.hapiPluginConfig=r,this.exitHandler=i,this.afterStarterService=n,this.startService=s,this.sendToClient=new v.Subject,this.sendTime=new v.Subject,this.clientConnected=new v.Subject,this.exitHandler.errorHandler.subscribe(e=>h(this,void 0,void 0,function*(){yield this.stopServerWatcher()})),this.server.events.on("response",e=>{this.sendToClient.next({query:e.payload,response:e.response.source})}),v.timer(0,1e3).pipe(S.tap(()=>this.sendTime.next(!0))).subscribe(),this.afterStarterService.appStarted.pipe(S.switchMapTo(this.waitXSeconds(5)),S.take(1),S.filter(()=>!this.connected),S.filter(()=>this.config.openBrowser),S.tap(()=>this.startService.startBrowser())).subscribe()}waitXSeconds(e){return v.Observable.create(t=>{const r=setTimeout(()=>t.next(!0),1e3*e);return()=>clearTimeout(r)})}register(){return h(this,void 0,void 0,function*(){this.config.openBrowser&&(this.createServerWatcher(),this.server.route({method:"GET",path:"/devtools/{param*}",handler:{directory:{path:`${__dirname.replace("services","")}/public`,index:["index.html","default.html"]}}}))})}stopServerWatcher(){return h(this,void 0,void 0,function*(){return yield new Promise(e=>this.serverWatcher.close(()=>e()))})}createServerWatcher(){this.serverWatcher=f.createServer(this.OnRequest.bind(this)),this.serverWatcher.listen(this.config.watcherPort||8967)}OnRequest(e,t){return"/status"===e.url?(this.connected||(this.clientConnected.next(!0),t.write("data: "+JSON.stringify({response:{init:!0}})+"\n\n")),this.connected=!0,t.writeHead(200,{"Content-Type":"text/event-stream","Access-Control-Allow-Origin":"*","Cache-Control":"no-cache",Connection:"keep-alive"}),this.sendToClient.subscribe(e=>{t.write("data: "+JSON.stringify(e)+"\n\n")}),this.sendTime.subscribe(e=>{t.write("data: "+JSON.stringify({time:(new Date).toLocaleTimeString()})+"\n\n")}),this.sendTime.subscribe(e=>{t.write("data: "+JSON.stringify({config:{graphql:this.config,hapi:this.server.info}})+"\n\n")}),void e.on("end",()=>{this.connected=!1,e.destroy()})):(t.statusCode=400,t.end())}};y=o([u.Plugin(),a(0,u.Inject(d.GRAPHQL_PLUGIN_CONFIG)),a(1,u.Inject(p.HAPI_SERVER)),a(2,u.Inject(p.HAPI_CONFIG)),c("design:paramtypes",["function"==typeof(e=void 0!==d.GRAPHQL_PLUGIN_CONFIG&&d.GRAPHQL_PLUGIN_CONFIG)&&e||Object,"function"==typeof(t=void 0!==l.Server&&l.Server)&&t||Object,"function"==typeof(r=void 0!==l.Server&&l.Server)&&r||Object,"function"==typeof(i=void 0!==u.ExitHandlerService&&u.ExitHandlerService)&&i||Object,"function"==typeof(n=void 0!==u.AfterStarterService&&u.AfterStarterService)&&n||Object,"function"==typeof(s=void 0!==b.StartService&&b.StartService)&&s||Object])],y),exports.ServerPushPlugin=y;
},{"../config.tokens":4,"./start.service":8}],15:[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./hooks.service")),e(require("./apollo.service")),e(require("./bootstrap.service")),e(require("./error.service")),e(require("./graphiql.service")),e(require("./hooks.service")),e(require("./schema.service")),e(require("./effect.service")),e(require("./server-push.service"));
},{"./hooks.service":25,"./apollo.service":5,"./bootstrap.service":6,"./error.service":31,"./graphiql.service":7,"./schema.service":26,"./effect.service":27,"./server-push.service":32}],71:[function(require,module,exports) {
"use strict";function e(e){return(t,r,o)=>{const s=o.value,c=t,n=r;return o.value=function(...t){const r=Object.create({});return r.resolve=s,r.args=e||null,r.method_type="query",r.method_name=n,r.target=c,r},c.constructor._descriptors=c.constructor._descriptors||new Map,c.constructor._descriptors.set(n,o),o}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Query=e;
},{}],40:[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./query.decorator"));
},{"./query.decorator":71}],70:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("graphql");function t(t){return function(r,n,o){const p=new r,a=Object.create({fields:{},name:r.name});return Object.keys(p).forEach(e=>a.fields[e]={type:p[e]}),r.prototype._metadata&&r.prototype._metadata.length&&r.prototype._metadata.forEach(e=>a.fields[e.key].resolve=e.resolve.bind(r.prototype)),t&&t.raw?r:function(){return t&&t.input?new e.GraphQLInputObjectType(a):new e.GraphQLObjectType(a)}}}exports.GapiObjectType=t;
},{}],41:[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./object-type.decorator"));
},{"./object-type.decorator":70}],72:[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(c,i){function o(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?c(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("@rxdi/core"),n=require("../../services/effect.service"),r=t.Container.get(t.ModuleService);function c(c){return(i,o,u)=>{const s=i;t.Container.get(n.EffectService).getLayer(c).getItemObservable(c).subscribe(t=>e(this,void 0,void 0,function*(){const e=r.watcherService.getConstructor(s.constructor.name);yield u.value.bind(e.value)(...t.data)}))}}exports.OfType=c;
},{"../../services/effect.service":27}],42:[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./of-type.decorator"));
},{"./of-type.decorator":72}],73:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("@rxdi/core");function n(n){const t=new n;return e.Container.has(t.name)||e.Container.set(t.name,t),e.Container.get(t.name)}function t(e){return function(t,r,o){t[r]=n(e),t.constructor.prototype[r]=n(e)}}function r(e){return n(e)}exports.TypeInjector=t,exports.InjectType=r;
},{}],43:[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./type-injector"));
},{"./type-injector":73}],74:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("@rxdi/core");function t(t){const r=new t;return e.Container.has(r.name)||e.Container.set(r.name,r),t={type:e.Container.get(r.name)},(e,r,n)=>{const o=e,s=n.value,c=r;return n.value=function(...e){const r=s.apply(e);return Object.assign(r,t),r},o.constructor._descriptors=o.constructor._descriptors||new Map,o.constructor._descriptors.set(c,n),n}}exports.Type=t;
},{}],44:[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./type.decorator"));
},{"./type.decorator":74}],75:[function(require,module,exports) {
"use strict";function t(){const t={public:!0};return(r,e,s)=>{const c=s,o=c.value,n=e,u=r;return c.value=function(...r){const e=o.apply(r);return Object.assign(e,t),e},u.constructor._descriptors=u.constructor._descriptors||new Map,u.constructor._descriptors.set(n,c),c}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Public=t;
},{}],45:[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./public.decorator"));
},{"./public.decorator":75}],79:[function(require,module,exports) {
"use strict";function e(e){return(t,r,o)=>{o.value;const s=t,u=s._metadata||[];return u.push({key:e,resolve:o.value}),s.constructor.prototype._metadata=u,o}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Resolve=e;
},{}],46:[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./resolver.decorator"));
},{"./resolver.decorator":79}],76:[function(require,module,exports) {
"use strict";function t(...t){const e={scope:t};return(t,r,s)=>{const o=s,c=o.value,n=r,u=t;return o.value=function(...t){const r=c.apply(t);return Object.assign(r,e),r},u.constructor._descriptors=u.constructor._descriptors||new Map,u.constructor._descriptors.set(n,o),o}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Scope=t;
},{}],47:[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./scope.decorator"));
},{"./scope.decorator":76}],77:[function(require,module,exports) {
"use strict";function t(t){return(e,r,o)=>{const s=o.value,n=e,c=r;return o.value=function(...e){const r=Object.create({});return r.resolve=s,r.args=t||null,r.method_type="mutation",r.method_name=c,r.target=n,r},n.constructor._descriptors=n.constructor._descriptors||new Map,n.constructor._descriptors.set(c,o),o}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Mutation=t;
},{}],48:[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./mutation.decorator"));
},{"./mutation.decorator":77}],78:[function(require,module,exports) {
"use strict";function t(t){const e={effect:t};return(t,r,s)=>{const c=t,o=s.value,n=r;return s.value=function(...t){const r=o.apply(t);return Object.assign(r,e),r},c.constructor._descriptors=c.constructor._descriptors||new Map,c.constructor._descriptors.set(n,s),s}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.EffectName=t;
},{}],49:[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./effect-name.decorator"));
},{"./effect-name.decorator":78}],17:[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./query/index")),e(require("./object-type/index")),e(require("./of-type/index")),e(require("./type-injector/index")),e(require("./type/index")),e(require("./public/index")),e(require("./query/index")),e(require("./resolver/index")),e(require("./scope/index")),e(require("./mutation/index")),e(require("./effect-name/index"));
},{"./query/index":40,"./object-type/index":41,"./of-type/index":42,"./type-injector/index":43,"./type/index":44,"./public/index":45,"./resolver/index":46,"./scope/index":47,"./mutation/index":48,"./effect-name/index":49}],1:[function(require,module,exports) {
"use strict";var e,r=this&&this.__decorate||function(e,r,o,i){var t,s=arguments.length,c=s<3?r:null===i?i=Object.getOwnPropertyDescriptor(r,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,r,o,i);else for(var a=e.length-1;a>=0;a--)(t=e[a])&&(c=(s<3?t(c):s>3?t(r,o,c):t(r,o))||c);return s>3&&c&&Object.defineProperty(r,o,c),c};function o(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0});const i=require("@rxdi/core"),t=require("./services"),s=require("./services/apollo.service"),c=require("./config.tokens"),a=require("./services/bootstrap.service"),l=require("./services/graphiql.service"),u=require("./services/start.service"),p=require("@gapi/playground");let n=e=class{static forRoot(r){return{module:e,services:[t.EffectService,{provide:c.GRAPHQL_PLUGIN_CONFIG,useValue:r},t.HookService,t.SchemaService],frameworkImports:[p.PlaygroundModule.forRoot({path:r.graphiQlPath||"/graphiql",endpoint:r.path||"/graphql",version:"1.7.1",graphiqlPlayground:r.graphiQlPlayground})]}}};n=e=r([i.Module({services:[t.HookService,a.BootstrapService,s.ApolloService,l.GraphiQLService,u.StartService],plugins:[t.ServerPushPlugin]})],n),exports.GraphQLModule=n,o(require("./decorators")),o(require("./services")),o(require("./config.tokens"));
},{"./services":15,"./services/apollo.service":5,"./config.tokens":4,"./services/bootstrap.service":6,"./services/graphiql.service":7,"./services/start.service":8,"./decorators":17}]},{},[1], null)
//# sourceMappingURL=/index.map